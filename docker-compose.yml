services:
  nerpybot-migrations:
    image: ghcr.io/nerdycraft/nerpybot-database-migrations:latest
    restart: "no"
    environment:
      NERPYBOT_DB_TYPE: sqlite
      NERPYBOT_DB_NAME: /data/db.db
      # ── PostgreSQL alternative ──
      # NERPYBOT_DB_TYPE: postgresql
      # NERPYBOT_DB_NAME: nerpybot
      # NERPYBOT_DB_USERNAME: nerpybot
      # NERPYBOT_DB_PASSWORD: changeme
      # NERPYBOT_DB_HOST: postgres
      # NERPYBOT_DB_PORT: "5432"
    volumes:
      - nerpybot-data:/data
    # depends_on:
    #   postgres:
    #     condition: service_healthy

  nerpybot:
    image: ghcr.io/nerdycraft/nerpybot:latest
    restart: unless-stopped
    depends_on:
      nerpybot-migrations:
        condition: service_completed_successfully
      # postgres:
      #   condition: service_healthy
    environment:
      # ── Required ──
      NERPYBOT_TOKEN: "your_bot_token_here"
      NERPYBOT_CLIENT_ID: "your_client_id_here"
      NERPYBOT_OPS: "your_discord_id_here"
      NERPYBOT_MODULES: "application,league,leavemsg,moderation,reactionrole,rolemanage,reminder,tagging,wow"
      # ── Database (SQLite default) ──
      NERPYBOT_DB_TYPE: sqlite
      NERPYBOT_DB_NAME: /data/db.db
      # ── Database (PostgreSQL alternative) ──
      # NERPYBOT_DB_TYPE: postgresql
      # NERPYBOT_DB_NAME: nerpybot
      # NERPYBOT_DB_USERNAME: nerpybot
      # NERPYBOT_DB_PASSWORD: changeme
      # NERPYBOT_DB_HOST: postgres
      # NERPYBOT_DB_PORT: "5432"
      # ── Music (requires tagging in NERPYBOT_MODULES) ──
      # NERPYBOT_YOUTUBE_KEY: "your_youtube_key_here"
      # ── League of Legends ──
      # NERPYBOT_RIOT_KEY: "your_riot_api_key_here"
      # ── World of Warcraft ──
      # NERPYBOT_WOW_CLIENT_ID: "your_wow_client_id_here"
      # NERPYBOT_WOW_CLIENT_SECRET: "your_wow_client_secret_here"
      # ── Error notifications (comma-separated Discord user IDs) ──
      # NERPYBOT_ERROR_RECIPIENTS: "your_discord_id_here"
      # ── Audio tuning ──
      # NERPYBOT_AUDIO_BUFFER_LIMIT: "5"
    volumes:
      - nerpybot-data:/data

  # ── Uncomment to use PostgreSQL instead of SQLite ──
  # postgres:
  #   image: postgres:18-alpine
  #   restart: unless-stopped
  #   environment:
  #     POSTGRES_DB: nerpybot
  #     POSTGRES_USER: nerpybot
  #     POSTGRES_PASSWORD: changeme  # change this!
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U nerpybot"]
  #     interval: 5s
  #     timeout: 5s
  #     retries: 5

volumes:
  nerpybot-data:
  # postgres-data:
